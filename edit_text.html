<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Edt-o</title>
	<style type="text/css">
	   *{
		margin: 0;
	   }
	   body{ 
		text-align: center;
		font-family: Verdana, Arial, Helvetica, sans-serif; 
		font-size: 12px;
		display: flex;
		flex-direction: column;
	   }
	   header{
		height: 10vh;
		display: flex;
		flex-direction: column;
		justify-content: center;
		align-content: center;
		background: rgb(253,29,29);
		background: linear-gradient(30deg, rgba(253,29,29,1) 0%, rgba(252,176,69,1) 100%);
		color: white;
	   }
	   button{
		height: 10vh;
        width: 100%;
		background-color: initial;
		border: 0;
		color: white;
		font-size: 14px;
		font-family: Verdana, Arial, Helvetica, sans-serif;
		font-weight: 900;
		cursor: pointer;
	   }
	   button:hover{
		background-color: initial;
		background-color: rgba(0, 0, 0, .2);
	   }
	   textarea{ 
		width: 100%;
		height: 30vh;
		resize: none;
		font-size: inherit;
		font-family: inherit;
		overflow-y: scroll;
		box-sizing: border-box;
	   }
	   p{
		text-align: left;
		padding: 5px 10px;
	   }
       .edit{
           box-shadow: inset 5px 0 #fd532c;
       }
	   .control{
		width: 100%;
		height: 10vh;
		background: rgb(253,29,29);
		background: linear-gradient(30deg, rgba(253,29,29,1) 0%, rgba(252,176,69,1) 100%);

	   }
	   #result{
		overflow-y: scroll;
		width: 100%;
		height: 50vh;
		margin: 0 auto;
		border-width: 1px;
		border-style: solid;
		box-sizing: border-box;
	   }
  </style>
</head>
<body>

<header><h1>Tfoxs</h1><h3 class="description">(BETA v1.1.) Правим текст вместе</h3></header>
<textarea id="textarea" name="comment" cols="70" rows="10" placeholder='Вставьте текст...
(После обработки текст копируется в буфер обмена)'></textarea>
<div class="control"><button onclick="fff()">Обработать</button></div>
<div id="result"></div>

<script type="text/javascript">

    function ttt() {
        const params = new Proxy(new URLSearchParams(window.location.search), {
            get: (searchParams, prop) => searchParams.get(prop),
        });
        let text = params.text;
        text = text.replace("AZUZU", "\n");
        let text_list = text.split("AZUZU");
        document.getElementById('result').innerHTML = "";

        text_list = text_list.map(function(el) {
            let ell = el.replace(/\s{2,}/g, " ")
            ell = ell.replace(/(^\s*)|(\s*$)/g, "")

            ell = ell.replace(/(^… )|(…)/g, "...")

            ell = ell.replace(/\?{3,}/g, "azu")
            ell = ell.replace(/!{3,}/g, "zazu")
            ell = ell.replace(/\?{1,2}/g, "?")
            ell = ell.replace(/!{1,2}/g, "!")
            ell = ell.replace(/zazu/g, "!!!")
            ell = ell.replace(/azu/g, "???")

            ell = ell.replace(/(\.+[\s.]*\.+)+/g, "...")
            ell = ell.replace(/\.([a-zA-Zа-яА-Я])/g, ". $1")
            ell = ell.replace(/([a-zA-Zа-яА-Я])\s+\./g, "$1.")
            ell = ell.replace(/[!?]*(!+\?+)[!?]*/g, "?!")
            ell = ell.replace(/[?.]*(\.+\?+)[?.]*|[?.]*(\?+\.+)[?.]*/g, "?..")
            ell = ell.replace(/[!.]*(\.+!+)[!.]*|[!.]*(!+\.+)[!.]*/g, "!..")
            ell = ell.replace(/[.!?]*(\.+!+\?+|\.+\?+!+|\?+\.+!+|\?+!+\.+|!+\.+\?+|!+\?+\.+)[.!?]*/g, "?!.")
            ell = ell.replace(/^\.{3}\s+/g, "...")

            ell = ell.replace(/—---/g, "")

            if (el === ell){
                document.getElementById('result').innerHTML += `<p>${ell}</p>`
            } else {
                document.getElementById('result').innerHTML += `<p class = "edit">${ell}</p>`
            }
            return ell;
        });

        text = text_list.join('\n\n')
        navigator.clipboard.writeText(text)

    }
    window.onload = ttt;

  function fff() {

      let textarea = document.getElementById('textarea');
      let text = textarea.value;
      text = text.replace(/\n{2,}/g, "AZUZUAZUZU");
      text = text.replace(/(\s[/\\]\s)|(\s[/\\])|([/\\]\s)|([/\\])|(\n)/g, "AZUZU");
      window.open (`edit_text.html?text=${text}`,'_self',false)

  }
</script>

</body>
</html>